<!doctype html><html lang=en><head><title>Automating Hugo deployments with GitHub and Webhooks on Ubuntu 24.04 LTS :: KatieThe.Dev</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In this blog post, I will walk you through the process of automating Hugo deployments using a bash script and setting up a webhook to streamline updates from GitHub. The guide is designed for users on Ubuntu Server 24.04 LTS."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/posts/2024/10/16/hugo-automated-deployments-webhooks-ubuntu-24.04/><script src=/js/copybutton.min.a48e6828da436de32d10a615cb3004fd3348a7da47c661db91071e2b87a4294a.js integrity="sha256-pI5oKNpDbeMtEKYVyzAE/TNIp9pHxmHbkQceK4ekKUo=" defer></script><link rel=stylesheet href=/css/copybutton.min.75f5869b00f9412a4549d98b7c11ffd9e909f2f91f9377ca8a54e3f73929da8f.css><link rel=stylesheet href=/css/post.min.a8e20cef7b7fb9121bd2bc5218fdbd711794e98ca0a77c5925a942f0c18d225a.css><link rel=stylesheet href=/css/style.min.5d346553c00b9bfe6fece597555899378195eac29d48e65b8cbfdfbbda8b4609.css><link rel=stylesheet href=/css/terminal.min.5eb1b018afcf7d962448970c5c4f52e50376a42ac669f08ea1432e5206f8e19a.css><link rel=stylesheet href=/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css><link rel=stylesheet href=/css/code.min.00125962708925857e7b66dbc58391d55be1191a3d0ce2034de8c9cd2c481c36.css><link rel=stylesheet href=/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css><link rel=stylesheet href=/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css><link rel=stylesheet href=/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css><link rel=stylesheet href=/css/main.min.fe8dc560fccb53a458b0db19ccb7b265764ac46b68596b7e099c6793054dd457.css><link rel=stylesheet href=/css/menu.min.83637a90d903026bc280d3f82f96ceb06c5fc72b7c1a8d686afb5bbf818a29f7.css><link rel=stylesheet href=/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css><link rel=stylesheet href=/css/prism.min.9023bbc24533d09e97a51a0a42a5a7bfe4c591ae167c5551fb1d2191d11977c0.css><link rel=stylesheet href=/css/syntax.min.cc789ed9377260d7949ea4c18781fc58959a89287210fe4edbff44ebfc1511b6.css><link rel=stylesheet href=/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=/favicon.png><link rel=apple-touch-icon href=/apple-touch-icon.png><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Automating Hugo deployments with GitHub and Webhooks on Ubuntu 24.04 LTS"><meta property="og:description" content="In this blog post, I will walk you through the process of automating Hugo deployments using a bash script and setting up a webhook to streamline updates from GitHub. The guide is designed for users on Ubuntu Server 24.04 LTS."><meta property="og:url" content="/posts/2024/10/16/hugo-automated-deployments-webhooks-ubuntu-24.04/"><meta property="og:site_name" content="KatieThe.Dev"><meta property="og:image" content="/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-10-16 15:50:57 -0600 -0600"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo><img src=/images/logo_hu8833275709582185121.png width=30 height=30 alt id=sitelogo>
KatieThe.Dev</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=/posts/2024/10/16/hugo-automated-deployments-webhooks-ubuntu-24.04/>Automating Hugo deployments with GitHub and Webhooks on Ubuntu 24.04 LTS</a></h1><div class=post-meta><time class=post-date>2024-10-16 15:50:57 -0600&nbsp;[Last Updated 2024-11-24 00:11:36 -0700]</time><span class=post-author>KatieTheDev</span><span class=post-reading-time>3 min read (624 words)</span></div><span class=post-tags>#<a href=/tags/hugo/>hugo</a>&nbsp;
#<a href=/tags/web-development/>web development</a>&nbsp;
#<a href=/tags/guides/>guides</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#create-hugo-deploy-script>Create Hugo deploy script</a></li><li><a href=#create-a-webhook>Create a webhook</a><ul><li><a href=#create-webhookconf>Create webhook.conf</a></li><li><a href=#add-systemd-service>Add systemd service</a></li><li><a href=#enable-the-webhook>Enable the webhook</a></li><li><a href=#view-webhook-logs>View Webhook Logs</a></li></ul></li></ul></nav></div><div class=post-content><div><h1 id=overview>Overview<a href=#overview class=hanchor arialabel=Anchor>#</a></h1><p>In this blog post, I will walk you through the process of automating Hugo deployments using a bash script and setting up a webhook to streamline updates from GitHub. The guide is designed for users on Ubuntu Server 24.04 LTS and covers three main components:</p><ol><li>Creating a Deployment Script: We will create a shell script that handles the tasks of pulling the latest code, building the Hugo site, and deploying it to the web directory. This script will ensure that your site is always up to date with the latest changes.</li><li>Configuring a Webhook: Once the deployment script is in place, we’ll set up a webhook configuration that allows GitHub to automatically trigger the deployment process every time you push code to your repository. This automation saves time and reduces the potential for manual errors.</li><li>Setting Up a Systemd Service: Finally, we’ll create a systemd service to manage the webhook, ensuring that it runs reliably and automatically on server startup. This includes configuring the service for SSL if needed.</li><li>Enable the webhook</li></ol><p>By the end of this post, you’ll have a fully automated Hugo deployment system that responds instantly to your code updates, enhancing your development workflow and improving site management.</p><h1 id=create-hugo-deploy-script>Create Hugo deploy script<a href=#create-hugo-deploy-script class=hanchor arialabel=Anchor>#</a></h1><p>I use the following script to automate Hugo deployments.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># Change directory into build directory</span>
</span></span><span style=display:flex><span>cd /home/katiethedev/build/katiethe.dev
</span></span><span style=display:flex><span><span style=color:#75715e># Remove existing files in build directory</span>
</span></span><span style=display:flex><span>rm -rf public
</span></span><span style=display:flex><span>rm -rf resources
</span></span><span style=display:flex><span><span style=color:#75715e># Run git pull as username </span>
</span></span><span style=display:flex><span>sudo -u username git pull
</span></span><span style=display:flex><span><span style=color:#75715e># Run Hugo with minify option to build a minified site, to save on bandwidth and storage. For development purposes you can remove --minify.</span>
</span></span><span style=display:flex><span>sudo -u username hugo --minify
</span></span><span style=display:flex><span><span style=color:#75715e># Change directories into web directory and then remove all present files</span>
</span></span><span style=display:flex><span>cd /var/www/katiethe.dev
</span></span><span style=display:flex><span>rm -rf *
</span></span><span style=display:flex><span><span style=color:#75715e># Copy all Hugo output files into web directory (switch username for your username)</span>
</span></span><span style=display:flex><span>cp -r /home/username/build/katiethe.dev/public/* /var/www/katiethe.dev
</span></span><span style=display:flex><span><span style=color:#75715e># Change ownership of all files in web directory to my user (change username to your username, change usergroup to your usergroup [usually the same as username])</span>
</span></span><span style=display:flex><span>chown username:usergroup * -R
</span></span><span style=display:flex><span><span style=color:#75715e># Reload nginx, log nginx status to webhook log, or show if ran manually</span>
</span></span><span style=display:flex><span>service nginx reload
</span></span><span style=display:flex><span>service nginx status 
</span></span></code></pre></div><p>This script was created on Ubuntu Server 24.04 LTS.</p><h1 id=create-a-webhook>Create a webhook<a href=#create-a-webhook class=hanchor arialabel=Anchor>#</a></h1><h2 id=create-webhookconf>Create webhook.conf<a href=#create-webhookconf class=hanchor arialabel=Anchor>#</a></h2><p>With that script created (I named it <code>hugo-deploy.sh</code>) and placed into a directory of your choice, we can now create a webhook. GitHub will call this webhook every time code is pushed to GitHub. This will automatically deploy the website.</p><p>I placed the following into <code>/etc/webhook.conf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;deploy&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;execute-command&#34;</span>: <span style=color:#e6db74>&#34;/home/username/hugo-deploy.sh&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;command-working-directory&#34;</span>: <span style=color:#e6db74>&#34;/home/username/&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;trigger-rule&#34;</span>:
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;match&#34;</span>:
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;payload-hash-sha1&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;secret&#34;</span>: <span style=color:#e6db74>&#34;your-secret&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;parameter&#34;</span>:
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;header&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;X-Hub-Signature&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>If you placed your script into a file other than your home directory, the specific locations may differ.</p><h2 id=add-systemd-service>Add systemd service<a href=#add-systemd-service class=hanchor arialabel=Anchor>#</a></h2><p>Lastly, I created a systemd service called <code>webhook</code> located at <code>/usr/lib/systemd/system/webhook.service</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[Unit]
</span></span><span style=display:flex><span>Description=Small server for creating HTTP endpoints (hooks)
</span></span><span style=display:flex><span>Documentation=https://github.com/adnanh/webhook/
</span></span><span style=display:flex><span>ConditionPathExists=/etc/webhook.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Service]
</span></span><span style=display:flex><span>ExecStart=/usr/bin/webhook -nopanic -hooks /etc/webhook.conf -secure -cert /etc/letsencrypt/live/katiethe.dev/fullchain.pem -key /etc/letsencrypt/live/katiethe.dev/privkey.pem -verbose
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[Install]
</span></span><span style=display:flex><span>WantedBy=multi-user.target
</span></span></code></pre></div><p>If you need SSL, replace the paths with the correct paths for your keys. Otherwise, feel free to remove them. My webhook is hosted behind NGINX, so I don&rsquo;t use keys for my webhook. Instead, NGINX terminates SSL for me and then passes the request to the webhook.</p><h2 id=enable-the-webhook>Enable the webhook<a href=#enable-the-webhook class=hanchor arialabel=Anchor>#</a></h2><p>After creating all of those files, simply run <code>sudo systemctl daemon-reload</code>, then enable and run the webhook:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl enable webhook
</span></span><span style=display:flex><span>sudo systemctl start webhook
</span></span></code></pre></div><p>You can now test your webhook with either curl or by adding it in GitHub. If you set a secret, make sure to add that to GitHub as well.</p><h2 id=view-webhook-logs>View Webhook Logs<a href=#view-webhook-logs class=hanchor arialabel=Anchor>#</a></h2><p>Webhooks can be viewed by running the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>journalctl -u webhook.service
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><a href=/posts/2024/11/10/democrats-great-failure-2024/ class="button inline prev">The Democrats' Great Failure of 2024
</a>::
<a href=/posts/2024/10/16/robots-txt/ class="button inline next">Robots.txt</a></div></div></article></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2024 KatieTheDev</span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span>
<span>&nbsp;:: <a href=https://github.com/KatieTheDev/katiethe.dev/tree/main target=_blank>View Source</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>